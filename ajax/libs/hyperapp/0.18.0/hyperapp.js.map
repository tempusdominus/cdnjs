{"version":3,"sources":["dist/hyperapp.js"],"names":["global","factory","exports","module","define","amd","hyperapp","this","h","type","props","node","stack","children","i","arguments","length","push","Array","isArray","pop","app","state","actions","view","container","vnode","element","map","tagName","toLowerCase","call","childNodes","nodeType","nodeValue","render","next","lock","root","patch","repaint","setTimeout","copy","target","source","obj","set","path","value","slice","get","init","key","action","data","then","concat","getKey","setElementProp","name","oldValue","style","_","removeAttribute","setAttribute","createElement","isSVG","document","createTextNode","createElementNS","oncreate","appendChild","removeChildren","onremove","removeElement","parent","cb","done","removeChild","onbeforeremove","oldNode","nextSibling","insertBefore","oldProps","onupdate","updateElement","len","oldLen","oldKeyed","oldElements","keyed","oldElement","oldKey","oldChild","j","newChild","newKey","keyedNode","reusableNode"],"mappings":"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","sourcesContent":["(function (global, factory) {\n\ttypeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) :\n\ttypeof define === 'function' && define.amd ? define(['exports'], factory) :\n\t(factory((global.hyperapp = {})));\n}(this, (function (exports) { 'use strict';\n\nfunction h(type, props) {\n  var node;\n  var stack = [];\n  var children = [];\n\n  for (var i = arguments.length; i-- > 2; ) {\n    stack.push(arguments[i]);\n  }\n\n  while (stack.length) {\n    if (Array.isArray((node = stack.pop()))) {\n      for (i = node.length; i--; ) {\n        stack.push(node[i]);\n      }\n    } else if (null == node || true === node || false === node) {\n    } else {\n      children.push(typeof node === \"number\" ? node + \"\" : node);\n    }\n  }\n\n  return typeof type === \"string\"\n    ? {\n        type: type,\n        props: props || {},\n        children: children\n      }\n    : type(props || {}, children)\n}\n\nfunction app(state, actions, view, container) {\n  var lock;\n  var root = container && container.children[0];\n  var node = vnode(root, [].map);\n  var stack = [];\n\n  repaint(init([], (state = copy(state)), (actions = copy(actions))));\n\n  return actions\n\n  function vnode(element, map) {\n    return (\n      element && {\n        type: element.tagName.toLowerCase(),\n        props: {},\n        children: map.call(element.childNodes, function(element) {\n          return 3 === element.nodeType\n            ? element.nodeValue\n            : vnode(element, map)\n        })\n      }\n    )\n  }\n\n  function render(next) {\n    lock = !lock;\n    next = view(state, actions);\n\n    if (container && !lock) {\n      root = patch(container, root, node, (node = next));\n    }\n\n    while ((next = stack.pop())) next();\n  }\n\n  function repaint() {\n    if (view && !lock) {\n      lock = !lock;\n      setTimeout(render);\n    }\n  }\n\n  function copy(target, source) {\n    var obj = {};\n\n    for (var i in target) obj[i] = target[i];\n    for (var i in source) obj[i] = source[i];\n\n    return obj\n  }\n\n  function set(path, value, source) {\n    var target = {};\n\n    if (!path.length) {\n      return value\n    } else {\n      target[path[0]] =\n        1 < path.length ? set(path.slice(1), value, source[path[0]]) : value;\n      return copy(source, target)\n    }\n  }\n\n  function get(path, source) {\n    for (var i = 0; i < path.length; i++) {\n      source = source[path[i]];\n    }\n    return source\n  }\n\n  function init(path, slice, actions) {\n    for (var key in actions) {\n      typeof actions[key] === \"function\"\n        ? (function(key, action) {\n            actions[key] = function(data) {\n              slice = get(path, state);\n\n              if (typeof (data = action(data)) === \"function\") {\n                data = data(slice, actions);\n              }\n\n              if (data && data !== slice && !data.then) {\n                repaint((state = set(path, copy(slice, data), state)));\n              }\n\n              return data\n            };\n          })(key, actions[key])\n        : init(\n            path.concat(key),\n            (slice[key] = slice[key] || {}),\n            (actions[key] = copy(actions[key]))\n          );\n    }\n  }\n\n  function getKey(node) {\n    return node && node.props ? node.props.key : null\n  }\n\n  function setElementProp(element, name, value, oldValue) {\n    if (name === \"key\") {\n    } else if (name === \"style\") {\n      for (var i in copy(oldValue, (value = value || {}))) {\n        element.style[i] = null == value[i] ? \"\" : value[i];\n      }\n    } else {\n      try {\n        element[name] = null == value ? \"\" : value;\n      } catch (_) {}\n\n      if (typeof value !== \"function\") {\n        if (null == value || false === value) {\n          element.removeAttribute(name);\n        } else {\n          element.setAttribute(name, value);\n        }\n      }\n    }\n  }\n\n  function createElement(node, isSVG) {\n    if (typeof node === \"string\") {\n      var element = document.createTextNode(node);\n    } else {\n      var element = (isSVG = isSVG || \"svg\" === node.type)\n        ? document.createElementNS(\"http://www.w3.org/2000/svg\", node.type)\n        : document.createElement(node.type);\n\n      if (node.props.oncreate) {\n        stack.push(function() {\n          node.props.oncreate(element);\n        });\n      }\n\n      for (var i = 0; i < node.children.length; i++) {\n        element.appendChild(createElement(node.children[i], isSVG));\n      }\n\n      for (var i in node.props) {\n        setElementProp(element, i, node.props[i]);\n      }\n    }\n    return element\n  }\n\n  function updateElement(element, oldProps, props) {\n    for (var i in copy(oldProps, props)) {\n      var oldValue = \"value\" === i || \"checked\" === i ? element[i] : oldProps[i];\n\n      if (props[i] !== oldValue) {\n        setElementProp(element, i, props[i], oldValue);\n      }\n    }\n\n    if (props.onupdate) {\n      stack.push(function() {\n        props.onupdate(element, oldProps);\n      });\n    }\n  }\n\n  function removeChildren(element, node, props) {\n    if ((props = node.props)) {\n      for (var i = 0; i < node.children.length; i++) {\n        removeChildren(element.childNodes[i], node.children[i]);\n      }\n\n      if (props.onremove) {\n        props.onremove(element);\n      }\n    }\n    return element\n  }\n\n  function removeElement(parent, element, node, cb) {\n    function done() {\n      parent.removeChild(removeChildren(element, node));\n    }\n\n    if (\n      node.props &&\n      node.props.onbeforeremove &&\n      typeof (cb = node.props.onbeforeremove(element)) === \"function\"\n    ) {\n      cb(done);\n    } else {\n      done();\n    }\n  }\n\n  function patch(parent, element, oldNode, node, isSVG, nextSibling) {\n    if (oldNode === node) {\n    } else if (null == oldNode) {\n      element = parent.insertBefore(createElement(node, isSVG), element);\n    } else if (node.type != null && node.type === oldNode.type) {\n      updateElement(element, oldNode.props, node.props);\n\n      isSVG = isSVG || node.type === \"svg\";\n\n      var len = node.children.length;\n      var oldLen = oldNode.children.length;\n      var oldKeyed = {};\n      var oldElements = [];\n      var keyed = {};\n\n      for (var i = 0; i < oldLen; i++) {\n        var oldElement = (oldElements[i] = element.childNodes[i]);\n        var oldChild = oldNode.children[i];\n        var oldKey = getKey(oldChild);\n\n        if (null != oldKey) {\n          oldKeyed[oldKey] = [oldElement, oldChild];\n        }\n      }\n\n      var i = 0;\n      var j = 0;\n\n      while (j < len) {\n        var oldElement = oldElements[i];\n        var oldChild = oldNode.children[i];\n        var newChild = node.children[j];\n\n        var oldKey = getKey(oldChild);\n        if (keyed[oldKey]) {\n          i++;\n          continue\n        }\n\n        var newKey = getKey(newChild);\n        var keyedNode = oldKeyed[newKey] || [];\n\n        if (null == newKey) {\n          if (null == oldKey) {\n            patch(element, oldElement, oldChild, newChild, isSVG);\n            j++;\n          }\n          i++;\n        } else {\n          if (oldKey === newKey) {\n            patch(element, keyedNode[0], keyedNode[1], newChild, isSVG);\n            i++;\n          } else if (keyedNode[0]) {\n            element.insertBefore(keyedNode[0], oldElement);\n            patch(element, keyedNode[0], keyedNode[1], newChild, isSVG);\n          } else {\n            patch(element, oldElement, null, newChild, isSVG);\n          }\n\n          j++;\n          keyed[newKey] = newChild;\n        }\n      }\n\n      while (i < oldLen) {\n        var oldChild = oldNode.children[i];\n        var oldKey = getKey(oldChild);\n        if (null == oldKey) {\n          removeElement(element, oldElements[i], oldChild);\n        }\n        i++;\n      }\n\n      for (var i in oldKeyed) {\n        var keyedNode = oldKeyed[i];\n        var reusableNode = keyedNode[1];\n        if (!keyed[reusableNode.props.key]) {\n          removeElement(element, keyedNode[0], reusableNode);\n        }\n      }\n    } else if (element && node !== element.nodeValue) {\n      if (typeof node === \"string\" && typeof oldNode === \"string\") {\n        element.nodeValue = node;\n      } else {\n        element = parent.insertBefore(\n          createElement(node, isSVG),\n          (nextSibling = element)\n        );\n        removeElement(parent, nextSibling, oldNode);\n      }\n    }\n\n    return element\n  }\n}\n\nexports.h = h;\nexports.app = app;\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\n})));\n//# sourceMappingURL=hyperapp.js.map\n"]}